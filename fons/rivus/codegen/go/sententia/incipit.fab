# Go Statement Generator - Entry Points
#
# Generates program entry points (main function).
#
# TRANSFORMS:
#   incipit { ... }                        -> func main() { ... }
#   incipit ergo cura arena fixum alloc { }  -> func main() { ... } (ignore arena)

§ ex "../../../ast/sententia" importa Sententia
§ ex "../nucleus" importa GoGenerator

§ ex "./index" importa genSententia

@ publica
functio genIncipit(in GoGenerator g, si de ignotum corpus, si de ignotum ergo) -> textus {
    # Generate main function body
    # For simple incipit { ... }, body is in corpus
    # For incipit ergo cura..., actual statements are in ergo

    varia body = ""

    # Check corpus first (simple incipit { ... })
    si nonnihil corpus {
        g.intraProfundum()
        body = genSententia(g, corpus qua Sententia)
        g.exiProfundum()
    }

    # Then check ergo (incipit ergo ... { ... })
    si nonnihil ergo {
        g.intraProfundum()
        fixum ergoBody = genSententia(g, ergo qua Sententia)
        g.exiProfundum()
        si body != "" {
            body = scriptum("§\n§", body, ergoBody)
        } secus {
            body = ergoBody
        }
    }

    si body == "" {
        redde scriptum("§func main() {}", g.ind())
    }

    redde scriptum("§func main() {\n§\n§}", g.ind(), body, g.ind())
}

# Async entry point - Go doesn't have async main, just use regular main
@ publica
functio genIncipiet(in GoGenerator g, si de ignotum corpus, si de ignotum ergo) -> textus {
    # Go doesn't have async main - generate regular main
    redde genIncipit(g, corpus, ergo)
}
