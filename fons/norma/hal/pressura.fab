# pressura.fab - Compression Device
#
# Etymology: "pressura" - pressing, squeezing. Data compression.
#
# Part of the Hardware Abstraction Layer (HAL).
#
# Design notes:
#   - comprime (compress): press data together
#   - solve (decompress): loosen/release compressed data
#   - Algorithms: gzip, deflate, brotli, zstd
#   - Levels: 1 (fast) to 9 (best compression)
#   - Sync operations suitable for data <10MB
#   - Streaming for large data

@ subsidia ts "codegen/ts/pressura.ts"
pactum pressura {
    # =========================================================================
    # ONE-SHOT OPERATIONS
    # =========================================================================

    # Compress bytes (optional level 1-9)
    @ externa
    functio comprime(textus algorithmus, octeti data, si numerus nivel) -> octeti

    # Decompress bytes
    @ externa
    functio solve(textus algorithmus, octeti data) -> octeti

    # =========================================================================
    # STREAMING
    # =========================================================================

    # Create compression stream (optional level 1-9)
    @ externa
    functio comprimens(textus algorithmus, si numerus nivel) -> Compressor

    # Create decompression stream
    @ externa
    functio solvens(textus algorithmus) -> Decompressor
}

# Compression stream
pactum Compressor {
    # Pour data in
    @ externa
    functio funde(octeti data) -> vacuum

    # Close and get compressed result
    @ externa
    functio claude() -> octeti
}

# Decompression stream
pactum Decompressor {
    # Pour compressed data in
    @ externa
    functio funde(octeti data) -> vacuum

    # Draw decompressed data out (partial)
    @ externa
    functio hauri() -> octeti

    # Close and get final result
    @ externa
    functio claude() -> octeti
}
