# File-level metadata: skip in rivus tests (stdlib not yet implemented)
- rivus: false

# JSON - JSON serialization functions
# Tests for norma/json module

# =============================================================================
# Basic Serialization
# =============================================================================

- name: solve (serialize to JSON)
  source: |
      ex "norma/hal/json" importa json
      fixum text = json.solve(42)
  expect:
      ts: 'const text = json.solve(42);'
      py:
          - 'import json'
          - 'text = json.dumps(42)'
      rs:
          - 'let text = serde_json::to_string(&42).unwrap();'
      cpp:
          - '#include <nlohmann/json.hpp>'
          - 'const auto text = nlohmann::json(42).dump();'
      zig:
          - 'const text = std.json.stringifyAlloc(alloc, 42, .{});'
      fab:
          - 'ex "norma/hal/json" importa json'
          - 'fixum text = json.solve(42)'

- name: solvePulchre (pretty print JSON)
  source: |
      ex "norma/hal/json" importa json
      fixum text = json.solvePulchre(42, 2)
  expect:
      ts: 'const text = json.solvePulchre(42, 2);'
      py:
          - 'import json'
          - 'text = json.dumps(42, indent=2)'
      rs:
          - 'let text = serde_json::to_string_pretty(&42).unwrap();'
      cpp:
          - '#include <nlohmann/json.hpp>'
          - 'const auto text = nlohmann::json(42).dump(2);'
      zig:
          - 'const text = std.json.stringifyAlloc(alloc, 42, .{ .whitespace = .{ .indent_level = 2 } });'
      fab:
          - 'ex "norma/hal/json" importa json'
          - 'fixum text = json.solvePulchre(42, 2)'

- name: pange (deserialize from JSON)
  source: |
      ex "norma/hal/json" importa json
      fixum obj = json.pange("{\"x\":1}")
  expect:
      ts: 'const obj = json.pange("{\"x\":1}");'
      py:
          - 'import json'
          - 'obj = json.loads("{\"x\":1}")'
      rs:
          - 'let obj = serde_json::from_str(&"{\"x\":1}").unwrap();'
      cpp:
          - '#include <nlohmann/json.hpp>'
          - 'const auto obj = nlohmann::json::parse("{\"x\":1}");'
      zig:
          - 'const obj = std.json.parseFromSlice(std.json.Value, std.heap.page_allocator, "{\"x\":1}", .{});'
      fab:
          - 'ex "norma/hal/json" importa json'
          - 'fixum obj = json.pange("{\"x\":1}")'
