# File-level metadata: skip in rivus tests (stdlib not yet implemented)
- rivus: false

# Tempus - Time stdlib functions
# Tests for norma/tempus module functions and constants

# =============================================================================
# Time Functions
# =============================================================================

- name: nunc (milliseconds)
  source: |
      ex "norma/hal/tempus" importa tempus
      fixum t = tempus.nunc()
  expect:
      ts: 'const t = tempus.nunc();'
      py:
          - 'import time'
          - 't = int(time.time() * 1000)'
      cpp:
          - '#include <chrono>'
          - 'const auto t = std::chrono::duration_cast<std::chrono::milliseconds>(std::chrono::system_clock::now().time_since_epoch()).count();'
      rs:
          - 'let t = std::time::SystemTime::now().duration_since(std::time::UNIX_EPOCH).unwrap().as_millis() as i64;'
      zig:
          - 'const t = std.time.milliTimestamp();'

- name: nunc_nano (nanoseconds)
  source: |
      ex "norma/hal/tempus" importa tempus
      fixum t = tempus.nuncNano()
  expect:
      ts: 'const t = tempus.nuncNano();'
      py:
          - 'import time'
          - 't = time.time_ns()'
      cpp:
          - '#include <chrono>'
          - 'const auto t = std::chrono::duration_cast<std::chrono::nanoseconds>(std::chrono::system_clock::now().time_since_epoch()).count();'
      rs:
          - 'let t = std::time::SystemTime::now().duration_since(std::time::UNIX_EPOCH).unwrap().as_nanos() as i64;'
      zig:
          - 'const t = std.time.nanoTimestamp();'

- name: nunc_secunda (seconds)
  source: |
      ex "norma/hal/tempus" importa tempus
      fixum t = tempus.nuncSecunda()
  expect:
      ts: 'const t = tempus.nuncSecunda();'
      py:
          - 'import time'
          - 't = int(time.time())'
      cpp:
          - '#include <chrono>'
          - 'const auto t = std::chrono::duration_cast<std::chrono::seconds>(std::chrono::system_clock::now().time_since_epoch()).count();'
      rs:
          - 'let t = std::time::SystemTime::now().duration_since(std::time::UNIX_EPOCH).unwrap().as_secs() as i64;'
      zig:
          - 'const t = std.time.timestamp();'

- name: dormi (sleep)
  source: |
      ex "norma/hal/tempus" importa tempus
      tempus.dormi(100)
  expect:
      ts: 'tempus.dormi(100);'
      py:
          - 'import time'
          - 'time.sleep(100 / 1000)'
      cpp:
          - '#include <chrono>'
          - '#include <thread>'
          - 'std::this_thread::sleep_for(std::chrono::milliseconds(100));'
      rs:
          - 'std::thread::sleep(std::time::Duration::from_millis(100 as u64));'
      zig:
          - 'std.time.sleep(100 * 1_000_000);'

# =============================================================================
# Duration Constants
# =============================================================================

- name: MILLISECUNDUM constant
  source: |
      fixum d = MILLISECUNDUM
  expect:
      ts: 'const d = 1;'
      py: 'd = 1'
      cpp:
          - 'const auto d = 1LL;'
      rs:
          - 'let d = 1_i64;'
      zig:
          - 'const d = 1;'

- name: SECUNDUM constant
  source: |
      fixum d = SECUNDUM
  expect:
      ts: 'const d = 1000;'
      py: 'd = 1000'
      cpp:
          - 'const auto d = 1000LL;'
      rs:
          - 'let d = 1000_i64;'
      zig:
          - 'const d = 1000;'

- name: MINUTUM constant
  source: |
      fixum d = MINUTUM
  expect:
      ts: 'const d = 60000;'
      py: 'd = 60000'
      cpp:
          - 'const auto d = 60000LL;'
      rs:
          - 'let d = 60000_i64;'
      zig:
          - 'const d = 60000;'

- name: HORA constant
  source: |
      fixum d = HORA
  expect:
      ts: 'const d = 3600000;'
      py: 'd = 3600000'
      cpp:
          - 'const auto d = 3600000LL;'
      rs:
          - 'let d = 3600000_i64;'
      zig:
          - 'const d = 3600000;'

- name: DIES constant
  source: |
      fixum d = DIES
  expect:
      ts: 'const d = 86400000;'
      py: 'd = 86400000'
      cpp:
          - 'const auto d = 86400000LL;'
      rs:
          - 'let d = 86400000_i64;'
      zig:
          - 'const d = 86400000;'

# =============================================================================
# Combined Usage
# =============================================================================

- name: sleep for one second
  source: |
      ex "norma/hal/tempus" importa tempus
      tempus.dormi(tempus.SECUNDUM())
  expect:
      ts: 'tempus.dormi(tempus.SECUNDUM());'
      py:
          - 'import time'
          - 'time.sleep(1000 / 1000)'
      cpp:
          - '#include <chrono>'
          - '#include <thread>'
          - 'std::this_thread::sleep_for(std::chrono::milliseconds(1000LL));'
      rs:
          - 'std::thread::sleep(std::time::Duration::from_millis(1000_i64 as u64));'
      zig:
          - 'std.time.sleep(1000 * 1_000_000);'
